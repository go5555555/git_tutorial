var TTDConversionEvents;(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{argsToSdkFunction:()=>X});var n={merchantId:null,advertiserId:null,enableDebug:!1,enableCookieSyncing:!0,rootUrl:"https://insight.adsrvr.org",dataProcessingOption:null,pixelVersion:"3.0.0"},o={tcfV2ConsentVersion:2,consentRequestHasTimedOut:!1,waitForConsentTimeout:null,consentCheckExists:!1,isGdprApplicable:!1,gdprConsentString:null},i=function(){return i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)},r=i({},o),a=i({},n);function c(e,t){if(r.consentRequestHasTimedOut)return u("tcfapi consent request timed out"),r.isGdprApplicable=!0,void s(e.listenerId);t&&(clearTimeout(r.waitForConsentTimeout),r.isGdprApplicable=e.gdprApplies,r.gdprConsentString=e.tcString,s(e.listenerId))}function s(e){window.__tcfapi("removeEventListener",2,(function(){}),e)}function d(){r.consentRequestHasTimedOut=!0}function u(e){a.enableDebug&&console.info("TTD Pixel v3: "+e)}var l,p=function(){return p=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},p.apply(this,arguments)},v=null,f={gppString:""},g=p({},n);function h(){l=!0}function y(e){var t;return l?(w("gpp request timed out"),void window.__gpp("removeEventListener",null,e.listenerId)):"signalStatus"===e.eventName&&"ready"===e.data?(f.gppString=null===(t=null==e?void 0:e.pingData)||void 0===t?void 0:t.gppString,clearTimeout(v),window.__gpp("removeEventListener",null,e.listenerId),m(f)):void w("gpp event invalid")}function m(e){var t="&gpp_consent="+e.gppString;return"".concat(t)}function w(e){g.enableDebug&&console.info("TTD Pixel v3: "+e)}function b(e,t,n){!function(e){var t=document.getElementById(e);do{t&&t.parentElement.removeChild(t),t=document.getElementById(e)}while(t)}(t);var o=document.createElement("iframe");function i(){document.body.appendChild(o)}return o.setAttribute("id",t),o.setAttribute("height","0"),o.setAttribute("width","0"),o.setAttribute("style","display:none;"),o.setAttribute("src",e),o.setAttribute("title",n),"complete"===document.readyState?setTimeout(i,0):window.addEventListener?window.addEventListener("load",i):window.attachEvent?window.attachEvent("onload",i):i(),o}function _(){var e=window,t="",n=!1;try{top.location.href&&(t=top.location.href)}catch(e){n=!0}if(n)for(;;)try{if(t=e.document.referrer,window.parent==e)break;e=window.parent}catch(e){break}return-1<t.indexOf("cloudfront.net")&&(t=function(e,t){t=t.replace(/\[/,"\\[").replace(/]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}(t,"url")||t),t}var k=function(){var e,t,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},o={isReady:!1,readyWait:1,holdReady:function(e){e?o.readyWait++:o.ready(!0)},ready:function(t){if(!0===t&&0==--o.readyWait||!0!==t&&!o.isReady){if(!document.body)return setTimeout((function(){return o.ready()}),1);if(o.isReady=!0,!0!==t&&--o.readyWait>0)return;null==e||e.resolveWith(document,[o])}},bindReady:function(){if(!e){if(e=o._Deferred(),"complete"===document.readyState)return setTimeout((function(){return o.ready()}),1);if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",(function(){return o.ready()}),!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",t),window.attachEvent("onload",o.ready);var n=!1;try{n=null==window.frameElement}catch(e){console.log(e)}document.documentElement.doScroll&&n&&i()}}},_Deferred:function(){var e,t=[],n=!1,i=!1,r={done:function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];if(!i){var c=void 0;e&&(c=e,e=void 0);for(var s=0,d=n;s<d.length;s++){var u=d[s],l=o.type(u);"array"===l?r.done.apply(r,u):"function"===l&&t.push(u)}c&&r.resolveWith(c[0],c[1])}return r},resolveWith:function(o,a){if(void 0===a&&(a=[]),!i&&!e&&!n){n=!0;try{for(;t.length;){var c=t.shift();null==c||c.apply(o,a)}}finally{e=[o,a],n=!1}}return r},resolve:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.resolveWith(this,e)},isResolved:function(){return!(!n&&!e)},cancel:function(){return i=!0,t=[],r}};return r},type:function(e){return null==e?String(e):n[Object.prototype.toString.call(e)]||"object"}};function i(){if(!o.isReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(i,1)}o.ready()}}return document.addEventListener?t=function(){document.removeEventListener("DOMContentLoaded",t,!1),o.ready()}:document.attachEvent&&(t=function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",t),o.ready())}),function(t){o.bindReady(),null==e||e.done(t)}}();function E(e){if(console.info("Detection started! Library is configured to detect: ",e.detectionSubject),console.info("Detection event type is ",e.detectionEventType),console.log("Full config: ",e),"onclick"===e.detectionEventType&&(e.detectionEventType="click"),"onsubmit"===e.detectionEventType||"click"===e.detectionEventType){var t=document.querySelector("body");t&&(T(t,"document",e),e.detectDynamicNodes&&I(t,"document",e))}else console.log("Detection type not supported! We will not start auto detection.")}function T(e,t,n){var o,i,r;n.scopedTriggers=null!==(o=n.scopedTriggers)&&void 0!==o?o:{},n.scopedValidInputs=null!==(i=n.scopedValidInputs)&&void 0!==i?i:{},n.scopedEventListeners=null!==(r=n.scopedEventListeners)&&void 0!==r?r:{},L(t,n),S(e,t,n)}function S(e,t,n){var o,i,r,a=C(e,t,n),c=C(e,t,n);n.scopedTriggers[t]=null!==(o=n.scopedTriggers[t])&&void 0!==o?o:[],n.scopedValidInputs[t]=null!==(i=n.scopedValidInputs[t])&&void 0!==i?i:[],n.scopedEventListeners[t]=null!==(r=n.scopedEventListeners[t])&&void 0!==r?r:[];for(var s=0,d=c;s<d.length;s++){var u=d[s];u&&u.tagName&&"INPUT"===u.tagName&&n.scopedValidInputs[t].push(u)}console.log('triggers ["'.concat(t,'"] '),a),console.log('validInputs ["'.concat(t,'"] '),c),a.forEach((function(e){n.scopedTriggers[t].push(e)}));for(var l=function(e){var o=function(){try{console.log("Detect event: ",n.detectionEventType,"on element, ",e);for(var t=Object.entries(n.scopedValidInputs).map((function(e){return e[1]})).flatMap((function(e){return e})),o=0,i=t;o<i.length;o++){var r=i[o].value.trim();if(U(r,n)){console.log("We detected: ",r),D(n);break}}}catch(e){console.log(e)}};n.scopedEventListeners[t].push(o),e.addEventListener(n.detectionEventType,o,{once:!0,capture:!0})},p=0,v=a;p<v.length;p++)l(v[p]);for(var f,g=(f=e,Array.from(f.querySelectorAll("*")).filter((function(e){return!!e.shadowRoot})).map((function(e){return e.shadowRoot}))),h=0;h<g.length;h++){var y=g[h],m=t+"/shadow_root_"+h;S(y,m,n),I(y,m,n)}}function D(e){console.log("Detection stopped."),function(e){if(e.detectDynamicNodes){console.log("Checking for dynamically added elements is turned off.");for(var t=0,n=Object.entries(e.scopedDynamicObservers);t<n.length;t++){var o=n[t][1];o&&o.disconnect(),e.scopedDynamicObservers={}}}}(e),L("all",e)}function L(e,t){if(console.log("clearing detection hooks (".concat(e,")")),"all"===e){for(var n=0,o=Object.entries(t.scopedTriggers);n<o.length;n++){var i=o[n],r=i[0];if(l=i[1])for(var a=0;a<l.length;a++)l[a].removeEventListener(t.detectionEventType,t.scopedEventListeners[r][a],{capture:!0})}t.scopedTriggers={},t.scopedEventListeners={}}else if(t.scopedTriggers){for(var c=[],s=0,d=Object.entries(t.scopedTriggers);s<d.length;s++){var u=d[s],l=(r=u[0],u[1]);if(r.startsWith(e)){if(l)for(a=0;a<l.length;a++)l[a].removeEventListener(t.detectionEventType,t.scopedEventListeners[r][a],{capture:!0});c.push(r)}}for(var p=0;p<c.length;p++)r=c[p],t.scopedTriggers[r]=[],t.scopedEventListeners[r]=[]}}function I(e,t,n){var o;n.detectDynamicNodes&&(n.scopedDynamicObservers=null!==(o=n.scopedDynamicObservers)&&void 0!==o?o:{},n.scopedDynamicObservers[t]=O((function(){console.log("Detected dynamically added nodes."),T(e,t,n)}),500),n.scopedDynamicObservers[t].observe(e,{childList:!0,subtree:!0,attributes:!0}))}function C(e,t,n){console.log('collectElements("'.concat(t,'", ').concat(n.cssSelectors,")"));for(var o=[],i=0,r=n.cssSelectors;i<r.length;i++)if((f=r[i]).length>0){var a=e.querySelectorAll(f);a&&a.forEach((function(e){o.includes(e)||o.push(e)}))}for(var c=window.location.hostname,s=document.getElementsByTagName("iframe"),d=0,u=Array.from(s);d<u.length;d++){var l=u[d];if(x(c,l)&&(l.__upixel_detection={root:e,scopeName:t+"/iframe",config:n},l.removeEventListener("load",j),l.addEventListener("load",j),l.contentDocument))for(var p=0,v=n.cssSelectors;p<v.length;p++){var f;(f=v[p]).length>0&&l.contentDocument.querySelectorAll(f).forEach((function(e){o.includes(e)||o.push(e)}))}}return o}function O(e,t){var n=0,o=null;return new MutationObserver((function(i,r){var a=Date.now(),c=a-n;c>=t?(n=a,e(i,r)):(o&&clearTimeout(o),o=setTimeout((function(){n=Date.now(),e(i,r)}),t-c))}))}function x(e,t){if(!t.src)return!1;try{var n=e===new URL(t.src).hostname;return n&&console.log("Iframe "+t.src+" can be accessed"),n}catch(e){return console.log("error: ",e),!1}}function j(e){var t=e.currentTarget;if(t&&t.__upixel_detection)try{T(t.__upixel_detection.root,t.__upixel_detection.scopeName,t.__upixel_detection.config)}catch(e){console.log(e)}}function U(e,t){return function(e,t){var n=/((([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,}))/i;if(t.detectionSubject.includes("email")&&n.test(e)){var o=function(e){return e.toLowerCase().trim()}(e.match(n)[0]);return console.log("We detected email: "+o),function(e,t){if(e&&t){var n=new CustomEvent("detected-identifier",{detail:{identifier:e,type:t}});console.info("Dispatched event with identifier: ",e," and type: ",t),window.dispatchEvent(n)}}(o,"email"),!0}return!1}(e,t)}O.prototype.observe=function(e,t){this.mutationObserver.observe(e,t)},O.prototype.disconnect=function(){null!=this.nextTimeoutHandle&&clearTimeout(this.nextTimeoutHandle),this.mutationObserver.disconnect()},O.prototype.takeRecords=function(){return this.mutationObserver.takeRecords()},O.prototype.throttledCallback=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Date.now();null!=this.args?this.args=e:this.lastInvocationTime+this.minDelayMs<n?(this.lastInvocationTime=n,this.callback(this.args)):(this.args=e,this.nextTimeoutHandle=setTimeout(function(){this.lastInvocationTime=Date.now(),this.nextTimeoutHandle=null,this.callback.apply(null,this.args),this.args=null}.bind(this),this.minDelayMs))};var P=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function c(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))},R=function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}};function A(e,t){var n=this;q(e,t),G(e)?t.sdkObj=window.__uid2:N(e)&&(t.sdkObj=window.__euid);try{t.sdkObj.callbacks.push((function(o,i){return P(n,void 0,void 0,(function(){var n,r,a;return R(this,(function(c){switch(c.label){case 0:switch(o){case"SdkLoaded":return[3,1];case"InitCompleted":return[3,2];case"IdentityUpdated":return[3,4]}return[3,5];case 1:try{window.__ttd_m_invoke_once=null!==(n=window.__ttd_m_invoke_once)&&void 0!==n?n:{},window.__ttd_m_invoke_once._uid_init||(window.__ttd_m_invoke_once._uid_init=1,null!==(r=e.baseUrl)&&void 0!==r||(e.baseUrl=t.uidBaseUrl),t.sdkObj.init({baseUrl:e.baseUrl}))}catch(e){console.info("Non-TTD actor initialized UID SDK, mind the consistency of UID baseUrl.",e)}return[3,5];case 2:return[4,V((function(){return i.identity}),e,t)];case 3:return c.sent(),[3,5];case 4:return(null===(a=i.identity)||void 0===a?void 0:a.advertising_token)&&(e.uid_token=i.identity.advertising_token),[3,5];case 5:return[2]}}))}))}))}catch(e){console.warn("Did not setup uid hooks: ",e)}}function H(e,t,n,o,i){void 0===window._uidSdkListenerLock[e]&&(window._uidSdkListenerLock[e]=1,q(t,n),void 0===n.sdkObj&&void 0===window.uidSdkLoaderPromise?window.uidSdkLoaderPromise=new Promise((function(e,t){var r=document.createElement("script");r.setAttribute("defer","true"),r.setAttribute("src",n.uidSdkUrl),r.addEventListener("load",(function(){e(),o()})),r.addEventListener("error",(function(e){t(e),i(e)})),document.body.appendChild(r)})):P(this,void 0,void 0,(function(){var e;return R(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,window.uidSdkLoaderPromise];case 1:return t.sent(),o(),[3,3];case 2:return e=t.sent(),console.warn("Failed to load uid sdk: ",e),[3,3];case 3:return[2]}}))})))}function V(e,t,n){return P(this,void 0,void 0,(function(){var o,i,r,a;return R(this,(function(c){switch(c.label){case 0:return c.trys.push([0,8,,9]),(o=e())?[3,3]:t.email?[4,n.sdkObj.setIdentityFromEmail(t.email,t)]:[3,2];case 1:return c.sent(),[3,3];case 2:t.emailHash?n.sdkObj.setIdentityFromEmailHash(t.emailHash,t):t.phone?n.sdkObj.setIdentityFromPhone(t.phone,t):t.phoneHash&&n.sdkObj.setIdentityFromPhoneHash(t.phoneHash,t),c.label=3;case 3:return o?(t.uid_token=o.advertising_token,[3,7]):[3,4];case 4:return window.ttdConversionEvents.activeDetection?[3,7]:(console.log("in fire or detect no identity"),i=new Promise((function(e){window.addEventListener("detected-identifier",(function(t){e(t.detail.identifier),window.ttdConversionEvents.activeDetection=null})),window.ttdConversionEvents.startDetection=E,window.ttdConversionEvents.startDetection(t)})),window.ttdConversionEvents.activeDetection=i,[4,i]);case 5:return r=c.sent(),[4,n.sdkObj.setIdentityFromEmail(r,t)];case 6:return c.sent(),[3,7];case 7:return[3,9];case 8:return a=c.sent(),console.warn("error setting up cstgOrDetect: ",a),[3,9];case 9:return[2]}}))}))}function N(e){return"EUID"===(null==e?void 0:e.type)||e.serverPublicKey.includes("EUID")}function G(e){return"UID2"===(null==e?void 0:e.type)||e.serverPublicKey.includes("UID2")}function q(e,t){G(e)?(t.uidSdkUrl="https://js.adsrvr.org/uid2-sdk-4.0.1.js",t.uidBaseUrl="https://global.prod.uidapi.com",t.rtUidTokenName="uid2_token"):N(e)&&(t.uidSdkUrl="https://js.adsrvr.org/euid-sdk-4.0.1.js",t.uidBaseUrl="https://prod.euid.eu",t.rtUidTokenName="euid_token")}var F,W=function(){return W=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},W.apply(this,arguments)},M=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{s(o.next(e))}catch(e){r(e)}}function c(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}s((o=o.apply(e,t||[])).next())}))},B=function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(r){return function(c){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}},J=W({},n),K={};function z(){window.ttdConversionEventsLayer.forEach(X)}function X(e){var t=e[0],s=e[1];if("init"===t||J.initComplete){switch(t){case"init":Z("init triggered"),function(e){var t,s=e.merchantId,p=e.advertiserId,k=e.enableCookieSyncing,E=e.enableDebug,T=e.rootUrl,S=e.dataProcessingOption,D=e.uidConfig,L=e.pixelIds,I=e.referrerUrl;M(this,void 0,void 0,(function(){var e;return B(this,(function(C){switch(C.label){case 0:J.merchantId=s,J.advertiserId=p,J.enableCookieSyncing=null!=k?k:n.enableCookieSyncing,J.enableDebug=null!==(t=null!=E?E:new URL(window.location.href).searchParams.has("upjs_debug"))&&void 0!==t?t:n.enableDebug,J.rootUrl=T||n.rootUrl,J.dataProcessingOption=S||n.dataProcessingOption,J.uidConfig=null!=D?D:void 0,J.pixelIds=null!=L?L:void 0,J.referrerUrl=null!=I?I:void 0,e=new Promise((function(e){return setTimeout(e,2e3)})),C.label=1;case 1:return C.trys.push([1,3,4,5]),[4,Promise.race([new Promise((function(e){var t,n,s,p="".concat(J.rootUrl,"/track/cei"),k=void 0!==J.merchantId&&null!==J.merchantId?"merchant_id=".concat(J.merchantId):"advertiser_id=".concat(J.advertiserId),E="&cookie_sync=".concat(J.enableCookieSyncing?1:0),T="".concat(p,"?").concat(k).concat(E,"&upv=").concat(J.pixelVersion);if(null!=J.dataProcessingOption&&(T+="&dpop=".concat(J.dataProcessingOption.policies,"&dpor=").concat(J.dataProcessingOption.region)),J.pixelIds&&(T+="&upid=".concat(J.pixelIds.join(","))),J.uidConfig){T+="&uidc_present=1",window._uidSdkListenerLock=null!==(t=window._uidSdkListenerLock)&&void 0!==t?t:{};var S=J.advertiserId+":"+(null!==(s=null===(n=J.pixelIds)||void 0===n?void 0:n.join(","))&&void 0!==s?s:"");Z("setting up uid config"),H(S,J.uidConfig,K,(function(){return A(J.uidConfig,K)}),(function(e){return console.warn("UID enabled but failed to register hooks: ",e)}))}else window.addEventListener("message",(function(e){!function(e,t,n){var o;try{var i;if(null!==e.origin&&"null"!==e.origin&&new URL(e.origin).hostname.endsWith(".adsrvr.org")&&"string"==typeof e.data){var r=JSON.parse(e.data);!r.type||"string"!=typeof r.type||"UID2"!==r.type&&"EUID"!==r.type||r.advertiserId&&"string"==typeof r.advertiserId&&r.advertiserId==t.advertiserId&&(window._uidSdkListenerLock=null!==(o=window._uidSdkListenerLock)&&void 0!==o?o:{},t.uidConfig=r,H(r.advertiserId+":"+r.pixelId,t.uidConfig,n,(function(){return A(t.uidConfig,n)}),(function(e){console.warn("UID enabled but failed to register hooks: ",e)})))}}catch(i){console.warn(i)}}(e,J,K)}));var D=function(e){if(r=i({},o),a=e,"function"==typeof window.__tcfapi){r.consentCheckExists=!0,r.waitForConsentTimeout=setTimeout(d,1e3),window.__tcfapi("addEventListener",r.tcfV2ConsentVersion,c),u("parse tcf response");var t="&gdpr=".concat(r.isGdprApplicable?1:0),n=null===r.gdprConsentString||void 0===r.gdprConsentString?"":"&gdpr_consent=".concat(r.gdprConsentString);return"".concat(t).concat(n)}u("tcfapi not a function")}(J);if(null!=D)T+="".concat(D);else{var L=function(e){if(g=e,"function"==typeof window.__gpp)return void 0!==(f=function(){var e=window.__gpp("ping");if("1.0"==e.gppVersion){var t=window.__gpp("getGPPData");f.gppString=null==t?void 0:t.gppString}else f.gppString=null==e?void 0:e.gppString;return f}()).gppString?(w("gpp response already loaded, parse response"),m(f)):(v=setTimeout(h,1e3),l=!1,window.__gpp("addEventListener",y),void 0!==f.gppString?(w("gpp response received, parse response"),m(f)):void 0);w("gpp not a function")}(J);T+="".concat(null!=L?L:"")}navigator.joinAdInterestGroup&&(T+="&paapi=1");var I=J.referrerUrl||_();T+="&ref=".concat(I);var C="universal_pixel";J.pixelIds&&(C+="_"+J.pixelIds.join("_")),Z("trigger GET conversion init call"),b(T,C,"TTD Universal Pixel").onload=function(){return e()}})),e])];case 2:return C.sent(),[3,5];case 3:return Y(C.sent()),[3,5];case 4:return J.initComplete=!0,z(),[7];case 5:return[2]}}))}))}(s);break;case"event":Z("event fire triggered"),Q(s,!0);break;case"optout":Z("optout triggered"),s.isoptout="1",Q(s,!1);break;default:throw Z("unexpected event triggered: "+t),"method not implemented"}!function(e){var t=window.ttdConversionEventsLayer.indexOf(e);-1!==t&&window.ttdConversionEventsLayer.splice(t,1)}(e)}}function Q(e,t){var n,o,i,a,c,s=null!==(n=e.privacy_settings)&&void 0!==n?n:[],d=function(){var e;if(r.consentCheckExists)return{privacy_type:"GDPR",is_applicable:r.isGdprApplicable,consent_string:null!==(e=r.gdprConsentString)&&void 0!==e?e:""};u("tcfapi consent status check failed")}(),l=function(){if(""!=f.gppString&&null!=f.gppString)return{privacy_type:"GPP",is_applicable:!0,consent_string:f.gppString}}();t&&(d?(s=s.filter((function(e){return e.privacy_type!==d.privacy_type})),e.gdpr=d.is_applicable,e.gdpr_consent=d.consent_string):l&&(s=s.filter((function(e){return e.privacy_type!==l.privacy_type})),e.gpp_consent=l.consent_string)),void 0!==J.merchantId&&null!==J.merchantId?e.merchant_id=J.merchantId:void 0!==J.advertiserId&&null!==J.advertiserId&&(e.adv=J.advertiserId),J.enableDebug&&(e.debug="1"),null!==(o=e.data_processing_option)&&void 0!==o||(e.data_processing_option=J.dataProcessingOption),null!==(i=e.pixel_ids)&&void 0!==i||(e.pixel_ids=J.pixelIds),null!==(a=e.referrer_url)&&void 0!==a||(e.referrer_url=J.referrerUrl||_()),(null===(c=J.uidConfig)||void 0===c?void 0:c.uid_token)&&(G(J.uidConfig)?e.uid2_token=J.uidConfig.uid_token:N(J.uidConfig)&&(e.euid_token=J.uidConfig.uid_token));var p={data:[W(W({},e),{privacy_settings:s})]};J.enableDebug&&(p.debug="1"),function(e,t){var n=this,o="".concat(J.rootUrl,"/track/realtimeconversion");return Z("trigger POST realtime conversion event"),new Promise((function(i,r){var a=new XMLHttpRequest;a.withCredentials=!0,a.open("POST",o),a.setRequestHeader("Content-type","application/json"),a.setRequestHeader("eventDataSource","JsSdk"),a.setRequestHeader("eventDataSourceVersion",J.pixelVersion),a.onload=function(){a.status>=200&&a.status<300?i(a.response):r(a.response)},a.onerror=function(){return M(n,void 0,void 0,(function(){return B(this,(function(n){return r(a.statusText),function(e,t){M(this,void 0,void 0,(function(){var n,o,i,r;return B(this,(function(a){var c,s;return n="universal_pixel_realtime_fallback_"+t.pixel_ids.join("_"),Z("trigger GET realtime conversion event fallback"),c=e.data[0],s=Object.entries(c).filter((function(e){var t=e[0],n=e[1];return("string"==typeof n||"number"==typeof n||"boolean"==typeof n||"pixel_ids"===t)&&null!=n&&""!==n})),o=s.map((function(e){var t=e[0],n=e[1];return"".concat(t,"=").concat(n)})).join("&"),i=J.pixelVersion,r="".concat(J.rootUrl,"/track/rt"),""!==o&&(r+="?"+o+"&eds=".concat("JsSdkGet")+"&edsv=".concat(i)+"&rt_fallback=1"),b(r,n,"TTD Universal Pixel Realtime Fallback"),[2]}))}))}(e,t),[2]}))}))},a.send(JSON.stringify(e))}))}(p,e).catch(Y)}function Y(e){J.enableDebug&&console.error("TTD Pixel v3: "+e)}function Z(e){J.enableDebug&&console.info("TTD Pixel v3: "+e)}function $(e,t,n,o,i,r){return M(this,void 0,void 0,(function(){var a,c,s,d,u;return B(this,(function(l){if(!e||""==e||!t||t.length<=0)return Z("no advertiser id or pixel id given"),[2];if(a="https://"+new URL(n).hostname,c={advertiserId:e,pixelIds:t,rootUrl:a,uidConfig:i,pixelVersion:"1.1.3",referrerUrl:r},window.ttdConversionEventsLayer.push(["init",c]),s={},o)for(d in o)void 0!==(u=o[d])&&(s[d]=u);return setTimeout((function(){!window._uidSdkListenerLock||J.uidConfig.uid_token?window.ttdConversionEventsLayer.push(["event",s]):document.addEventListener("visibilitychange",ee)}),1e3),[2]}))}))}function ee(e){return M(this,void 0,void 0,(function(){return B(this,(function(t){return"hidden"===document.visibilityState&&(Q(e,!1),document.removeEventListener("visibilitychange",ee)),[2]}))}))}window.ttdConversionEventsLayer=window.ttdConversionEventsLayer||[],window.ttdConversionEvents=null!==(F=window.ttdConversionEvents)&&void 0!==F?F:{activeDetection:null,startDetection:null},z(),window.ttdConversionEventsLayer.push=function(e){return Array.prototype.push.call(window.ttdConversionEventsLayer,e),X(e),this.length},window.ttd_dom_ready=k,window.TTDUniversalPixelApi=function(e){this.init=function(t,n,o,i,r){$(null!=t?t:void 0,null!=n?n:void 0,null!=o?o:void 0,null!=i?i:void 0,null!=r?r:void 0,null!=e?e:void 0)}},window.ttd_up_api={topLevelUrl:"",set_top_level_url:function(e){this.topLevelUrl=e},init:function(e,t,n,o,i){$(e,t,n,o,i,this.topLevelUrl)}},TTDConversionEvents=t})();